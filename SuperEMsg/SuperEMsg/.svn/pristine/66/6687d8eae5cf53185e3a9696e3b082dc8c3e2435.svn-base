package com.hy.superemsg.activity;

import android.os.Bundle;
import android.support.v4.app.FragmentActivity;
import android.view.View;
import android.widget.Toast;

import com.hy.superemsg.R;
import com.hy.superemsg.SuperEMsgApplication;
import com.hy.superemsg.components.UITitle;
import com.hy.superemsg.req.ReqNewsCategory;
import com.hy.superemsg.rsp.BaseRspApi;
import com.hy.superemsg.rsp.Category;
import com.hy.superemsg.rsp.NewsCategory;
import com.hy.superemsg.rsp.RspNewsCategory;
import com.hy.superemsg.utils.CommonUtils;
import com.hy.superemsg.utils.HttpUtils;
import com.hy.superemsg.utils.HttpUtils.AsynHttpCallback;
import com.hy.superemsg.viewpager.AbsListFragment;
import com.hy.superemsg.viewpager.ScrollTabsViewPager;
import com.hy.superemsg.viewpager.fragments.NewsListFragment;
import com.hy.superemsg.viewpager.fragments.PicListFragment;

public class NewsActivity extends FragmentActivity {
	private ScrollTabsViewPager pager;

	@Override
	protected void onCreate(Bundle arg0) {
		super.onCreate(arg0);
		setContentView(R.layout.activity_sms);
		pager = (ScrollTabsViewPager) this.findViewById(R.id.viewpager);
		UITitle title = (UITitle) this.findViewById(R.id.ui_title);
		if (title != null) {
			title.setTitleText(R.string.baiku_info);
			title.setLeftButton(R.drawable.back, new View.OnClickListener() {

				@Override
				public void onClick(View v) {
					finish();
				}
			});
		}
		HttpUtils.getInst().excuteTask(new ReqNewsCategory(),
				new AsynHttpCallback() {

					@Override
					public void onSuccess(BaseRspApi rsp) {
						RspNewsCategory category = (RspNewsCategory) rsp;
						if (CommonUtils.isNotEmpty(category.categorylist)) {
							for (NewsCategory cate : category.categorylist) {
								AbsListFragment fragment = null;
								if (cate.contenttype == NewsCategory.TYPE_PIC) {
									fragment = new PicListFragment();
								} else {
									fragment = new NewsListFragment();

								}
								Bundle b = new Bundle();
								b.putParcelable("categoryid", cate);
								fragment.setArguments(b);
								pager.addPager(cate.categoryname, fragment);
							}
						}
						pager.setUp(NewsActivity.this);
					}

					@Override
					public void onError(String error) {
						SuperEMsgApplication.toast(error);
					}
				});
	}
}
